<div class="p-2 flex border-b border-gray-200">
  <input id="friend-input" type="text" placeholder="Найти друга по нику..." class="flex-1 border rounded-full px-3 py-1 focus:outline-none focus:ring-2 focus:ring-blue-400">
  <button id="add-friend-btn" class="ml-2 bg-blue-500 text-white px-3 py-1 rounded-full hover:bg-blue-600">Добавить</button>
</div>

<script type="module">
import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm'

const supabaseUrl = 'https://kjjzlkbyzlpkbieboaoo.supabase.co'
const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imtqanpsa2J5emxwa2JpZWJvYW9vIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI1MjMxNTQsImV4cCI6MjA3ODA5OTE1NH0.MdoZunGrL5q-UTeT-Rwbapei7d0msNt0g6LG7_rHrHc'
const supabase = createClient(supabaseUrl, supabaseKey)

const { data: { user: currentUser } } = await supabase.auth.getUser()

const input = document.getElementById('friend-input')
const btn = document.getElementById('add-friend-btn')

btn.addEventListener('click', async () => {
  const username = input.value.trim()
  if (!username) return alert('Введите ник друга')

  // Ищем пользователя по нику
  const { data: friendUser, error } = await supabase
    .from('users')
    .select('*')
    .eq('username', username)
    .single()
  if (error || !friendUser) return alert('Пользователь не найден')

  // Добавляем дружбу (двусторонне)
  await supabase.from('friends').upsert([
    { user_id: currentUser.id, friend_id: friendUser.id },
    { user_id: friendUser.id, friend_id: currentUser.id }
  ])

  alert(`${username} добавлен в друзья!`)
})
</script>
